<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ç¿»å¡è¨˜æ†¶éŠæˆ² â€” è‰åŸæ°´å½©å‹•ç‰©ï¼ˆ20å¼µï¼ŒçœŸäººèªéŸ³ï¼‰</title>
<style>
  :root{
    --gap: 10px;
    --cols: 5;
    --rows: 4;
    --cardW: 140px; /* JS å‹•æ…‹èª¿æ•´ */
    --aspect: 1.32;
    --ink:#2a2a2a;
    --line:#eadfce;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:#fffdf8; color:var(--ink);
    font-family: system-ui,-apple-system,"Segoe UI",Roboto,"PingFang TC","Microsoft JhengHei",Arial,sans-serif;
  }
  header{ padding:12px 14px 0 14px;}
  .bar{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;}
  .title{ font-weight:800; font-size:clamp(16px,2.6vw,24px);}
  .controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
  select,button,label,input[type="checkbox"]{
    padding:8px 10px; border-radius:12px; border:1px solid var(--line); background:#fff;
    font-size:14px;
  }
  .controls button{
    background:linear-gradient(#ffffff,#faf6ee);
    border:1px solid #e6dccb; cursor:pointer;
    box-shadow:0 1px 0 rgba(255,255,255,.7) inset, 0 2px 8px rgba(0,0,0,.06);
  }
  .controls button:active{ transform: translateY(1px); }
  .stats{ padding:6px 14px 10px; font-size:14px; opacity:.9}
  main{ height: calc(100vh - var(--headerH, 128px)); padding: 10px 12px 18px;}
  .grid{
    display:grid;
    grid-template-columns: repeat(var(--cols), var(--cardW));
    grid-auto-rows: calc(var(--cardW) * var(--aspect));
    gap: var(--gap);
    place-content: center;
  }

  /* å¡ç‰‡ */
  .card{
    position:relative; width: var(--cardW); height: calc(var(--cardW) * var(--aspect));
    perspective:1000px; border:0; background:transparent; padding:0; cursor:pointer;
  }
  .inner{ position:absolute; inset:0; transform-style:preserve-3d; transition: transform 420ms ease; border-radius:20px; }
  .inner.flipped{ transform: rotateY(180deg); }
  .face{
    position:absolute; inset:0; backface-visibility:hidden; border-radius:20px; overflow:hidden;
    border:2px solid var(--line); background:#fff;
    box-shadow:0 6px 14px rgba(0,0,0,.10), 0 1px 0 rgba(255,255,255,.6) inset;
  }
  .front{ display:flex; align-items:center; justify-content:center; background:#fff; }
  .front .art{
    position:absolute; inset:8%;
    border-radius:16px;
    background-image:
      url("A_watercolor_painting_displays_sixteen_square_card.png"),
      radial-gradient(120% 120% at 50% 10%, #cde6ff 0%, #d9efff 30%, rgba(255,255,255,0) 60%),
      linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(112,181,132,0.18) 45%, rgba(89,156,108,0.28) 80%),
      radial-gradient(100% 80% at 50% 90%, rgba(167,216,170,0.55) 0%, rgba(255,255,255,0) 60%);
    background-size: cover, 100% 100%, 100% 100%, 100% 100%;
    background-position: center;
    filter: saturate(.98) contrast(.98);
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.04), inset 0 18px 40px rgba(255,255,255,.5);
  }
  .back{ transform: rotateY(180deg); display:flex; flex-direction:column; }
  .img-wrap{ flex:1; display:flex; align-items:center; justify-content:center; padding:10px; }
  .back img{ max-width:100%; max-height:100%; object-fit: contain; border-radius:10px; }
  .label{ text-align:center; padding:8px 6px 10px; font-weight:700; color:#2b4333; }
  .win{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background: rgba(255,255,255,.82); z-index:10;
  }
  .win .box{ background:#fff; border:1px solid var(--line); border-radius:16px; padding:20px 22px; text-align:center; }
  .win .box h2{ margin:0 0 8px; }
</style>
</head>
<body>
<header id="hdr">
  <div class="bar">
    <div class="title">ç¿»å¡è¨˜æ†¶éŠæˆ² Â· è‰åŸæ°´å½©å‹•ç‰©</div>
    <div class="controls">
      <label><input type="checkbox" id="voiceToggle" checked> å•Ÿç”¨ç™¼éŸ³</label>
      <button id="resetBtn">é‡ç©</button>
    </div>
  </div>
  <div class="stats" id="stats">æ­¥æ•¸ï¼š0ã€€ï½œã€€é…å°ï¼š0 / 10</div>
</header>

<main><div class="grid" id="grid" role="grid"></div></main>
<div class="win" id="win">
  <div class="box">
    <h2>å¤ªæ£’äº†ï¼å…¨éƒ¨é…å°æˆåŠŸ ğŸ‰</h2>
    <p id="winStats"></p>
    <button id="againBtn">å†ç©ä¸€æ¬¡</button>
  </div>
</div>

<script>
const ANIMALS = [
  {name:"Bear", img:"bear_text.jpg"},
  {name:"Cat", img:"cat_text.jpg"},
  {name:"Chicken", img:"chicken_text.jpg"},
  {name:"Cow", img:"cow_text.jpg"},
  {name:"Dog", img:"dog_text.jpg"},
  {name:"Elephant", img:"elephant_text.jpg"},
  {name:"Fish", img:"fish_text.jpg"},
  {name:"Fox", img:"fox_text.jpg"},
  {name:"Giraffe", img:"giraffe_text.jpg"},
  {name:"Gorilla", img:"gorilla_text.jpg"},
  {name:"Hippo", img:"hippo_text.jpg"},
  {name:"Horse", img:"horse_text.jpg"},
  {name:"Lion", img:"lion.jpg"},
  {name:"Panda", img:"panda_text.jpg"},
  {name:"Pig", img:"pig_text.jpg"},
  {name:"Rabbit", img:"rabbit_text.jpg"},
  {name:"Rhino", img:"rhino_text.jpg"},
  {name:"Sheep", img:"sheep_text.jpg"},
  {name:"Tiger", img:"tiger.jpg"}
];
const PICK = 10;
const grid = document.getElementById('grid');
const stats = document.getElementById('stats');
const win = document.getElementById('win');
const winStats = document.getElementById('winStats');
const againBtn = document.getElementById('againBtn');
const resetBtn = document.getElementById('resetBtn');
const voiceToggle = document.getElementById('voiceToggle');
let deck=[], first=null, second=null, lock=false, steps=0, matched=0;

/* === æ–°ç‰ˆ fitAllï¼Œç¢ºä¿ä»»ä½•è¢å¹•éƒ½èƒ½çœ‹åˆ°æ‰€æœ‰å¡ç‰Œ === */
function fitAll(){
  const hdrH = document.getElementById('hdr').offsetHeight || 120;
  const W = document.documentElement.clientWidth - 24;
  const H = (document.documentElement.clientHeight - hdrH) - 24;
  const cols = 5, rows = 4, gap = 10, aspect = 1.32;
  const w1 = (W - gap*(cols-1)) / cols;
  const h1 = (H - gap*(rows-1)) / rows / aspect;
  let size = Math.floor(Math.min(w1, h1));
  size = Math.max(60, Math.min(160, size));
  document.documentElement.style.setProperty('--cardW', size + 'px');
}
window.addEventListener('resize', fitAll);

function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
function newDeck(){const pool=[...ANIMALS];shuffle(pool);const chosen=pool.slice(0,PICK);deck=[];chosen.forEach(a=>deck.push({...a}));chosen.forEach(a=>deck.push({...a}));shuffle(deck);}
function buildGrid(){grid.innerHTML='';deck.forEach((card,idx)=>{const el=document.createElement('button');el.className='card';el.setAttribute('aria-label',card.name);el.innerHTML=`<div class="inner" data-idx="${idx}"><div class="face front"><div class="art"></div></div><div class="face back"><div class="img-wrap"><img alt="${card.name}" src="${card.img}"></div><div class="label">${card.name}</div></div></div>`;el.addEventListener('click',()=>onFlip(el.querySelector('.inner'),card));grid.appendChild(el);});}
function onFlip(inner,card){if(lock)return;if(inner.classList.contains('flipped'))return;inner.classList.add('flipped');speak(card.name);if(!first){first={inner,card};return;}if(first.inner===inner)return;second={inner,card};lock=true;steps++;updateStats();if(first.card.name===second.card.name){matched++;setTimeout(()=>{first=null;second=null;lock=false;if(matched===PICK)showWin();},200);}else{setTimeout(()=>{first.inner.classList.remove('flipped');second.inner.classList.remove('flipped');first=null;second=null;lock=false;},700);}}
function updateStats(){stats.textContent=`æ­¥æ•¸ï¼š${steps}ã€€ï½œã€€é…å°ï¼š${matched} / ${PICK}`;}
function showWin(){winStats.textContent=`å…± ${steps} æ­¥å®Œæˆé…å°`;win.style.display='flex';}
function resetGame(){steps=0;matched=0;first=null;second=null;lock=false;win.style.display='none';newDeck();buildGrid();fitAll();updateStats();}
function speak(text){if(!voiceToggle.checked)return;try{const utt=new SpeechSynthesisUtterance(text);utt.lang='en-US';utt.rate=0.95;window.speechSynthesis.cancel();window.speechSynthesis.speak(utt);}catch(e){}}
resetBtn.addEventListener('click', resetGame);againBtn.addEventListener('click', resetGame);
resetGame();
</script>
</body>
</html>
